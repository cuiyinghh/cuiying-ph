(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-12b677af"],{1005:function(t,e,n){"use strict";var a=n("a2c5");n.n(a).a},"7abe":function(t,e,n){"use strict";n.r(e);var a=n("5880"),i=(n("2cbd"),n("ab2c")),o=n("862d"),s=n.n(o);var r,c,l,u={name:"map",components:(r={},c=i.a.name,l=i.a,c in r?Object.defineProperty(r,c,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[c]=l,r),props:{},data:function(){return{showSheet:!1,sheetData:{title:"",content:"",currentMark:null},geo:{lat:0,lng:0},testTxt:""}},mounted:function(){this.loadMapPromise=this.initAMap()},watch:{},methods:{initAMap:function(){var t=this;return new Promise((function(e,n){s.a.load({key:"aaa4c7d4873757deb1f5ceff26e8bbb9",version:"2.0",plugins:["AMap.Geolocation","AMap.Walking","AMap.TileLayer"]}).then((function(n){t.map=new n.Map("container",{viewMode:"3D",zoom:15,center:[125.209476,43.849681]}),t.AMap=n,t.locateH5(),t.map.on("click",(function(e){t.hideDlg(),t.hideWalking()})),e()})).catch((function(t){n(t)}))}))},loopLocate:function(){var t=this;this.map.plugin("AMap.Geolocation",(function(){var e=new t.AMap.Geolocation({enableHighAccuracy:!0,timeout:15e3,maximumAge:0,convert:!0,showButton:!1,position:"LB",offset:new t.AMap.Pixel(10,20),showMarker:!0,showCircle:!1,panToLocation:!1,zoomToAccuracy:!1});t.map.addControl(e),t.testTxt="开始定位!!!",e.getCurrentPosition((function(e,n){t.testTxt="".concat(t.testTxt," ====== ").concat(JSON.stringify(n));var a=n&&n.position||{};!t.geo.lng&&"complete"==e&&a.lng&&(t.moveCenter(a),t.geo=a)}))}))},locateH5:function(){var t=this;this.loadMapPromise.finally((function(){t.testTxt="开始定位!!!",navigator&&navigator.geolocation&&(t.testTxt="".concat(t.testTxt," ====== 有navigator"),t.intervalId=setInterval((function(){navigator.geolocation.getCurrentPosition((function(e){var n=e.coords.latitude,a=e.coords.longitude;t.testTxt="".concat(t.testTxt," ======================= nav获取的经纬度: ").concat(a+"~"+n),t.AMap.convertFrom([a,n],"gps",(function(e,n){t.testTxt="".concat(t.testTxt," =====高德转换后的经纬度 ").concat(JSON.stringify(n)),t.geo=n.locations[0],t.updateGeoShow()}))}),(function(t){}),{enableHighAcuracy:!0,timeout:1e4,maximumAge:1e3})}),1e3))}))},updateGeoShow:function(){this.geoMarker?this.geoMarker.setPosition(new this.AMap.LngLat(this.geo.lng,this.geo.lat)):(this.geoMarker=new this.AMap.Marker({position:new this.AMap.LngLat(this.geo.lng,this.geo.lat),icon:new this.AMap.Icon({size:new this.AMap.Size(20,20),imageSize:new this.AMap.Size(20,20),image:"https://a.amap.com/jsapi/static/image/plugin/point.png",imageOffset:new this.AMap.Pixel(0,0)}),anchor:"center"}),this.map.add(this.geoMarker))},moveCenter:function(t){this.map&&this.map.setCenter(t)},markPoints:function(t){var e=this;t&&t.length&&this.loadMapPromise.finally((function(){t.forEach((function(t){var n=new e.AMap.Marker({position:new e.AMap.LngLat(t.lng,t.lat),icon:new e.AMap.Icon({image:t.icon||"https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png",imageOffset:new e.AMap.Pixel(0,0)}),anchor:"bottom-center",label:{content:t.label||"",direction:"bottom",offset:new e.AMap.Pixel(0,5)}});n.rawData=t,e.map.add(n),n.on("click",(function(a){e.moveCenter([t.lng,t.lat]),t.des_title&&e.showDlg({title:t.des_title,content:t.des_detail||"",currentMark:n}),e.hideWalking()}),n)}))}))},showRoute:function(t){var e=this,n=this.sheetData.currentMark;if(n&&this.geo.lng&&n.rawData.lng){var a={map:this.map,panel:"panel",hideMarkers:!0,isOutline:!0,outlineColor:"#ffeeee",autoFitView:!0};this.walking=new this.AMap.Walking(a),this.walking.search([this.geo.lng,this.geo.lat],[n.rawData.lng,n.rawData.lat],(function(t,n){e.hideDlg()}))}},hideWalking:function(){this.walking&&this.walking.clear()},showDlg:function(t){this.sheetData=t,this.showSheet=!0},hideDlg:function(){this.showSheet=!1,this.sheetData={}}},beforeDestroy:function(){this.intervalId&&clearInterval(this.intervalId)}},h=(n("9259"),n("2877"));function p(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function f(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?p(Object(n),!0).forEach((function(e){g(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function g(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var m={name:"home",components:{Map:Object(h.a)(u,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"map-wrap"},[n("div",{attrs:{id:"container"}}),n("div",{attrs:{id:"panel"}}),n("div",{staticClass:"testtxt"},[t._v(t._s(t.testTxt))]),n("van-action-sheet",{attrs:{overlay:!1,closeable:!1},model:{value:t.showSheet,callback:function(e){t.showSheet=e},expression:"showSheet"}},[n("div",{staticClass:"dlg-wrap"},[n("div",{staticClass:"title-line"},[n("div",{staticClass:"title"},[t._v(t._s(t.sheetData.title))]),n("div",{staticClass:"route-btn",on:{click:function(e){return t.showRoute()}}},[t._v("路线")])]),n("div",{staticClass:"content"},[t._v(t._s(t.sheetData.content))])])])],1)}),[],!1,null,"4f38caf2",null).exports},data:function(){return{}},created:function(){var t=this;this.getBuldings().finally((function(){t.markPoints(t.buildingData)}))},computed:f(f({},Object(a.mapState)(["buildingData"])),Object(a.mapGetters)([])),methods:f(f(f({},Object(a.mapMutations)([])),Object(a.mapActions)(["getBuldings"])),{},{markPoints:function(t){this.$refs.map.markPoints(t)}})},d=(n("1005"),Object(h.a)(m,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"home-wrap"},[e("div",{staticClass:"map-wrap"},[e("Map",{ref:"map"})],1)])}),[],!1,null,"bd32e084",null));e.default=d.exports},9259:function(t,e,n){"use strict";var a=n("ad05");n.n(a).a},a2c5:function(t,e,n){},ad05:function(t,e,n){}}]);